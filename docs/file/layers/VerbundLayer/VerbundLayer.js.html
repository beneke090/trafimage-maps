<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">layers/VerbundLayer/VerbundLayer.js | trafimage-maps</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#verbundlayer">VerbundLayer</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/layers/VerbundLayer/VerbundLayer.js~VerbundLayer.html">VerbundLayer</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">layers/VerbundLayer/VerbundLayer.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import VectorLayer from &apos;ol/layer/Vector&apos;;
import VectorSource from &apos;ol/source/Vector&apos;;
import GeoJSON from &apos;ol/format/GeoJSON&apos;;
import {
  Style,
  Fill as FillStyle,
  Stroke as StrokeStyle,
  Text as TextStyle,
} from &apos;ol/style&apos;;
import { containsExtent } from &apos;ol/extent&apos;;
import MultiPolygon from &apos;ol/geom/MultiPolygon&apos;;
import { fromExtent } from &apos;ol/geom/Polygon&apos;;
import Feature from &apos;ol/Feature&apos;;
import { intersect } from &apos;turf&apos;;
import Layer from &apos;react-spatial/Layer&apos;;

/**
 * Layer for visualizing fare networks.
 */
class VerbundLayer extends Layer {
  constructor(options) {
    super({
      name: &apos;Verbundzonen&apos;,
      visible: true,
      olLayer: new VectorLayer({
        source: new VectorSource(),
      }),
      ...options,
    });

    // Cache for zone styles
    this.zoneStyleCache = {};

    // Load features
    const url = (options || {}).url || &apos;/public/sample_data/zones.geojson&apos;;
    this.loadFeatures(url);

    // Set style
    this.olLayer.setStyle((f, r) =&gt; this.zoneStyle(f, r));
  }

  loadFeatures(url) {
    const format = new GeoJSON();
    fetch(url)
      .then(res =&gt; res.json())
      .then(data =&gt; {
        const features = format.readFeatures(data);
        this.olLayer.getSource().clear();
        this.olLayer.getSource().addFeatures(features);
      });
  }

  zoneStyle(feature, resolution) {
    const zone = parseInt(feature.get(&apos;zone&apos;), 10);

    let opacity = 0.5;
    opacity = resolution &lt; 100 ? 0.3 : opacity;
    opacity = resolution &lt; 50 ? 0.1 : opacity;

    let textGeometry;
    const color = [255, 200, 25];

    if (resolution &lt; 100) {
      // optimize text positioning
      const mapExtent = this.map.getView().calculateExtent();
      const geomExtent = feature.getGeometry().getExtent();

      if (!containsExtent(mapExtent, geomExtent)) {
        const mapPolygon = fromExtent(mapExtent);
        const format = new GeoJSON();
        const intersection = intersect(
          format.writeFeatureObject(new Feature(mapPolygon)),
          format.writeFeatureObject(feature),
        );

        if (intersection) {
          const intersectionFeature = format.readFeature(intersection);
          const geom = intersectionFeature.getGeometry();
          if (geom instanceof MultiPolygon) {
            textGeometry = geom.getInteriorPoints();
          } else {
            textGeometry = geom.getInteriorPoint();
          }
        }
      }
    }

    return [
      new Style({
        stroke: new StrokeStyle({
          color,
          width: 2,
        }),
        fill: new FillStyle({
          color: [...color, opacity],
        }),
      }),
      new Style({
        geometry: textGeometry,
        text: new TextStyle({
          font: &apos;12px Arial&apos;,
          fill: new FillStyle({
            color: &apos;black&apos;,
          }),
          stroke: new StrokeStyle({
            color: &apos;white&apos;,
            width: 2,
          }),
          text: `${zone}`,
        }),
      }),
    ];
  }

  init(map) {
    super.init(map);
    this.map = map;
  }
}

export default VerbundLayer;
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
